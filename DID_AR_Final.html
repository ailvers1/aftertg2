<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>DID AR - ì¦ê°•í˜„ì‹¤ ë””ìŠ¤í”Œë ˆì´ ë°°ì¹˜</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #000;
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

/* AR ìº”ë²„ìŠ¤ */
canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* ì‹œì‘ í™”ë©´ ì˜¤ë²„ë ˆì´ */
#startOverlay {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

#startOverlay.hidden {
  display: none;
}

.logo {
  font-size: 64px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

.title {
  color: white;
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 10px;
  text-align: center;
  text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

.subtitle {
  color: rgba(255,255,255,0.9);
  font-size: 16px;
  margin-bottom: 40px;
  text-align: center;
  line-height: 1.5;
  max-width: 400px;
}

/* ARButton ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• */
#ARButton {
  background: white !important;
  color: #667eea !important;
  border: none !important;
  border-radius: 50px !important;
  padding: 20px 60px !important;
  font-size: 20px !important;
  font-weight: bold !important;
  cursor: pointer !important;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3) !important;
  transition: all 0.3s !important;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
}

#ARButton:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 12px 32px rgba(0,0,0,0.4) !important;
}

#ARButton:active {
  transform: translateY(0) !important;
}

/* ë°°ì¹˜ ë²„íŠ¼ - ë°©í–¥ë³„ ìœ„ì¹˜ */
#placeButton {
  position: fixed;
  background: #0ea5e9;
  color: white;
  border: none;
  border-radius: 16px;
  padding: 18px 32px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(0,0,0,0.6);
  z-index: 100;
  display: none;
  transition: all 0.3s;
}

/* ì„¸ë¡œ ëª¨ë“œ */
@media (orientation: portrait) {
  #placeButton {
    bottom: 100px;
    right: 20px;
  }
}

/* ê°€ë¡œ ëª¨ë“œ */
@media (orientation: landscape) {
  #placeButton {
    top: 50%;
    right: 20px;
    transform: translateY(-50%);
  }
}

#placeButton:active {
  transform: scale(0.95);
  box-shadow: 0 2px 8px rgba(0,0,0,0.6);
}

/* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
#toast {
  position: fixed;
  left: 50%;
  bottom: 200px;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.9);
  color: white;
  padding: 14px 24px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  z-index: 200;
  display: none;
  white-space: nowrap;
}

/* ë°©í–¥ ì¸ë””ì¼€ì´í„° */
#orientationInfo {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 10px 16px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  z-index: 100;
  display: none;
}

/* ìŠ¤í¬ë¦°ìƒ· ì•ˆë‚´ */
#screenshotTip {
  position: fixed;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(102,126,234,0.95);
  color: white;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 14px;
  text-align: center;
  z-index: 100;
  display: none;
  max-width: 90%;
}
</style>
</head>
<body>

<!-- ì‹œì‘ ì˜¤ë²„ë ˆì´ -->
<div id="startOverlay">
  <div class="logo">ğŸ“±âœ¨</div>
  <div class="title">DID AR</div>
  <div class="subtitle">
    ì¦ê°•í˜„ì‹¤ë¡œ ì‚¼ì„± DID ë””ìŠ¤í”Œë ˆì´ë¥¼<br>
    ì‹¤ì œ ê³µê°„ì— ë°°ì¹˜í•˜ê³  ì²´í—˜í•´ë³´ì„¸ìš”
  </div>
  <!-- ARButtonì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
</div>

<!-- AR ì»¨íŠ¸ë¡¤ -->
<button id="placeButton">ğŸ“ ë°°ì¹˜í•˜ê¸°</button>
<div id="toast"></div>
<div id="orientationInfo"></div>
<div id="screenshotTip">ğŸ’¡ ìŠ¤í¬ë¦°ìƒ·ì€ í•¸ë“œí°ì˜ ìº¡ì²˜ ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì„¸ìš”</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
import { ARButton } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/webxr/ARButton.js';

// ìš”ì†Œ ì°¸ì¡°
const startOverlay = document.getElementById('startOverlay');
const placeButton = document.getElementById('placeButton');
const toast = document.getElementById('toast');
const orientationInfo = document.getElementById('orientationInfo');
const screenshotTip = document.getElementById('screenshotTip');

// í† ìŠ¤íŠ¸ ë©”ì‹œì§€
function showToast(message, duration = 2500) {
  toast.textContent = message;
  toast.style.display = 'block';
  setTimeout(() => {
    toast.style.display = 'none';
  }, duration);
}

// ë°©í–¥ ê°ì§€
function updateOrientation() {
  const isLandscape = window.innerWidth > window.innerHeight;
  orientationInfo.textContent = isLandscape ? 'ğŸ“± ê°€ë¡œ ëª¨ë“œ' : 'ğŸ“± ì„¸ë¡œ ëª¨ë“œ';
}

window.addEventListener('resize', updateOrientation);
window.addEventListener('orientationchange', () => {
  setTimeout(updateOrientation, 100);
});
updateOrientation();

// Three.js ì„¤ì •
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  70,
  window.innerWidth / window.innerHeight,
  0.01,
  20
);

const renderer = new THREE.WebGLRenderer({ 
  antialias: true, 
  alpha: true 
});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.xr.enabled = true;
document.body.appendChild(renderer.domElement);

// ì¡°ëª…
const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
light.position.set(0.5, 1, 0.25);
scene.add(light);

const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
dirLight.position.set(0, 1, 0);
scene.add(dirLight);

// ë¦¬í‹°í´ (ë°”ë‹¥ í‘œì‹œ)
const reticle = new THREE.Mesh(
  new THREE.RingGeometry(0.15, 0.2, 32).rotateX(-Math.PI / 2),
  new THREE.MeshBasicMaterial({ color: 0x00ffff })
);
reticle.matrixAutoUpdate = false;
reticle.visible = false;
scene.add(reticle);

// DID ëª¨ë¸ ìƒì„±
function createDIDModel() {
  const group = new THREE.Group();
  
  // ë³¸ì²´ (ê²€ì€ìƒ‰ í”„ë ˆì„)
  const body = new THREE.Mesh(
    new THREE.BoxGeometry(0.6, 0.4, 0.03),
    new THREE.MeshStandardMaterial({ 
      color: 0x222222,
      metalness: 0.4,
      roughness: 0.6
    })
  );
  group.add(body);
  
  // í™”ë©´ (íŒŒë€ìƒ‰ ë””ìŠ¤í”Œë ˆì´)
  const screen = new THREE.Mesh(
    new THREE.PlaneGeometry(0.55, 0.35),
    new THREE.MeshBasicMaterial({ 
      color: 0x3366ff,
      side: THREE.DoubleSide
    })
  );
  screen.position.z = 0.016;
  group.add(screen);
  
  return group;
}

// ë°°ì¹˜ëœ ëª¨ë¸ë“¤
const placedModels = [];

// Hit test
let hitTestSource = null;
let hitTestSourceRequested = false;
let localSpace = null;

// AR ì„¸ì…˜ ì‹œì‘ ì‹œ
function onARSessionStarted(session) {
  console.log('AR ì„¸ì…˜ ì‹œì‘ë¨');
  
  session.addEventListener('end', () => {
    console.log('AR ì„¸ì…˜ ì¢…ë£Œë¨');
    hitTestSourceRequested = false;
    hitTestSource = null;
    startOverlay.classList.remove('hidden');
    placeButton.style.display = 'none';
    orientationInfo.style.display = 'none';
    screenshotTip.style.display = 'none';
  });
  
  // UI ì—…ë°ì´íŠ¸
  startOverlay.classList.add('hidden');
  placeButton.style.display = 'block';
  orientationInfo.style.display = 'block';
  
  showToast('ë°”ë‹¥ì„ ë¹„ì¶°ì£¼ì„¸ìš”', 3000);
}

// ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
renderer.setAnimationLoop((timestamp, frame) => {
  if (frame) {
    const referenceSpace = renderer.xr.getReferenceSpace();
    const session = renderer.xr.getSession();
    
    if (!hitTestSourceRequested) {
      session.requestReferenceSpace('viewer').then((refSpace) => {
        localSpace = refSpace;
        session.requestHitTestSource({ space: refSpace }).then((source) => {
          hitTestSource = source;
          console.log('Hit test source ìƒì„±ë¨');
        });
      });
      
      hitTestSourceRequested = true;
      onARSessionStarted(session);
    }
    
    if (hitTestSource) {
      const hitTestResults = frame.getHitTestResults(hitTestSource);
      
      if (hitTestResults.length > 0) {
        const hit = hitTestResults[0];
        const pose = hit.getPose(referenceSpace);
        
        reticle.visible = true;
        reticle.matrix.fromArray(pose.transform.matrix);
      } else {
        reticle.visible = false;
      }
    }
  }
  
  renderer.render(scene, camera);
});

// ë°°ì¹˜ ë²„íŠ¼ í´ë¦­
placeButton.addEventListener('click', () => {
  if (reticle.visible) {
    const model = createDIDModel();
    model.position.setFromMatrixPosition(reticle.matrix);
    model.quaternion.setFromRotationMatrix(reticle.matrix);
    
    scene.add(model);
    placedModels.push(model);
    
    showToast(`âœ… ëª¨ë¸ ë°°ì¹˜ë¨ (${placedModels.length}ê°œ)`);
    
    // ì²« ë°°ì¹˜ ì‹œ ìŠ¤í¬ë¦°ìƒ· ì•ˆë‚´
    if (placedModels.length === 1) {
      screenshotTip.style.display = 'block';
      setTimeout(() => {
        screenshotTip.style.display = 'none';
      }, 5000);
    }
  } else {
    showToast('âš ï¸ ë°”ë‹¥ì„ ë¨¼ì € ì¸ì‹í•´ì£¼ì„¸ìš”');
  }
});

// ARButton ìƒì„± ë° ìŠ¤íƒ€ì¼ë§
const arButton = ARButton.createButton(renderer, {
  requiredFeatures: ['hit-test'],
  optionalFeatures: []
});

// ARButtonì„ ì‹œì‘ ì˜¤ë²„ë ˆì´ì— ì¶”ê°€
arButton.id = 'ARButton';
arButton.textContent = 'ğŸš€ AR ì‹œì‘í•˜ê¸°';
startOverlay.appendChild(arButton);

// ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

console.log('DID AR ì•± ì´ˆê¸°í™” ì™„ë£Œ');
</script>

</body>
</html>
